# umapi_sms_ru
======

Nodejs модуль для работы с API сервиса [umapi.sms.ru](http://umapi.sms.ru)

Официальная документация по работе с API – [http://umapi.sms.ru/?panel=api](http://umapi.sms.ru/?panel=api)
## Установка
```
npm install umapi_sms_ru
```

## Использование

Подключение:
```js
var UMAPI_SMS_RU = require('umapi_sms_ru');
```

Авторизация (с помощью api_id):
```js
var sms = new UMAPI_SMS_RU(api_id);
```


### Отправка SMS:

```js
sms.send( to, msg, from , ip, time, daytime, translit, test)
.then(console.log)
.catch(console.error)
```

|Параметр|Обязательный|Описание                                                                           |
|--------|------------|-----------------------------------------------------------------------------------|
|to|Да|Номер телефона получателя (либо несколько номеров, через запятую — до 100 штук за один запрос).|
|msg|Да|Текст сообщения в кодировке UTF-8|
|from|Нет|Имя отправителя (должно быть согласовано с администрацией). Если не заполнено, в качестве отправителя будет указан ваш отправитель по умолчанию.|
|ip|Нет|Если СМС сообщение отправляется в ответ на действия пользователя (например сообщение содержит код авторизации), то мы можем защитить вас на случай от действий злоумышленников, которые вынуждают вас отправлять много сообщений на один или разные номера (к примеру, регистрируясь много раз подряд на вашем сайте с одного IP адреса). В этом параметре вы можете передать нам IP адрес вашего пользователя, и, если мы заметим, что с этим IP связано большое количество сообщений, то мы их начнем блокировать (ограничение настраивается в разделе "Настройки").|
|time|Нет|Если вам нужна отложенная отправка, то укажите время отправки. Указывается в формате UNIX TIME (пример: 1280307978). Должно быть не больше 2 месяцев с момента подачи запроса. Если время меньше текущего времени, сообщение отправляется моментально.|
|daytime|Нет|Учитывает часовой пояс получателя. Если у получателя сейчас ночь (уже наступило время 20:00), то откладывает отправку до 10 часов утра. Если указан этот параметр, то параметр time игнорируется. 0 - не учитывать 1 - учитывать По умолчанию 0|
|translit|Нет|Переводит все русские символы в латинские. 0 - не переводить 1 - переводить По умолчанию 0|
|test|Нет|Имитирует отправку сообщения для тестирования ваших программ на правильность обработки ответов сервера. При этом само сообщение не отправляется и баланс не расходуется. 0 - обычная отправка 1 - тестовая отправка По умолчанию 0|

### Проверить статус отправленных сообщений:

```js
sms.status(sms_id)
.then(console.log)
.catch(console.error)
```

|Параметр|Обязательный|Описание                                                                           |
|--------|------------|-----------------------------------------------------------------------------------|
|sms_id|Да|Идентификатор сообщения, полученный при использовании метода send. Можно указать несколько идентификаторов через запятую (до 100 штук за раз).|

### Проверить стоимость сообщений перед отправкой:

```js
sms.cost(to, msg, from, translit)
.then(console.log)
.catch(console.error)
```

|Параметр|Обязательный|Описание                                                                           |
|--------|------------|-----------------------------------------------------------------------------------|
|to|Да|Номер телефона получателя (либо несколько номеров, через запятую — до 100 штук за один запрос).    |
|msg|Да|Текст сообщения в кодировке UTF-8                                                                 |
|from|Нет|Имя отправителя (должно быть согласовано с администрацией). Если не заполнено, в качестве отправителя будет указан ваш отправитель по умолчанию.|
|translit|Нет|Переводит все русские символы в латинские. 0 - не переводить 1 - переводить По умолчанию 0|

### Получить информацию о балансе:

```js
sms.balance()
.then(console.log)
.catch(console.error)
```

### Получить информацию о дневном лимите и его использовании:

```js
sms.limit()
.then(console.log)
.catch(console.error)
```

### Получение списка одобренных отправителей:

```js
sms.senders()
.then(console.log)
.catch(console.error)
```

### Получить информацию о бесплатных сообщениях и его использовании:

```js
sms.free()
.then(console.log)
.catch(console.error)
```

### Добавление номера в стоплист:

```js
sms.stoplist_add(stoplist_phone, stoplist_text)
.then(console.log)
.catch(console.error)
```

|Параметр|Обязательный|Описание                                                                           |
|--------|------------|-----------------------------------------------------------------------------------|
|stoplist_phone|Да|Номер телефона, который необходимо добавить в стоплист.    |
|stoplist_text|Да|Примечание к номеру (причина добавления в стоплист).    |

### Удаление номера из стоплиста:

```js
sms.stoplist_del(stoplist_phone)
.then(console.log)
.catch(console.error)
```

|Параметр|Обязательный|Описание                                                                           |
|--------|------------|-----------------------------------------------------------------------------------|
|stoplist_phone|Да|Номер телефона, который необходимо удалить из стоплиста.    |

### Получить весь стоплист:

```js
sms.stoplist_get()
.then(console.log)
.catch(console.error)
```

### Добавить callback обработчик:

```js
sms.callback_add(url)
.then(console.log)
.catch(console.error)
```

|Параметр|Обязательный|Описание                                                                           |
|--------|------------|-----------------------------------------------------------------------------------|
|url|Да|Адрес обработчика (должен начинаться на http://)    |

### Удалить callback обработчик:

```js
sms.callback_del(url)
.then(console.log)
.catch(console.error)
```

|Параметр|Обязательный|Описание                                                                           |
|--------|------------|-----------------------------------------------------------------------------------|
|url|Да|Адрес обработчика (должен начинаться на http://)    |

### Получить весь список обработчиков:

```js
sms.callback_get()
.then(console.log)
.catch(console.error)
```

### Авторизовать пользователя по звонку с его номера:

```js
sms.callcheck_add(phone)
.then(console.log)
.catch(console.error)
```

|Параметр|Обязательный|Описание                                                                           |
|--------|------------|-----------------------------------------------------------------------------------|
|phone|Да|Номер телефона пользователя, который необходимо авторизовать (с которого мы будем ожидать звонок)    |

### Проверка статуса звонка:

```js
sms.callcheck_status(check_id)
.then(console.log)
.catch(console.error)
```

|Параметр|Обязательный|Описание                                                                           |
|--------|------------|-----------------------------------------------------------------------------------|
|check_id|Да|Идентификатор авторизации, полученный от нас в примере выше  |


## Автор

[Alexandr Nikulin](https://github.com/SashokNekulin/), e-mail: [nekulin@mail.ru](mailto:nekulin@mail.ru)
